{% schema %}
{
  "name": "Custom Hero Section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Lorem ipsum dolor sit amet" },
    { "type": "textarea", "id": "subheading", "label": "Subheading", "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut." },
    { "type": "image_picker", "id": "hero_image", "label": "Hero Image" },
    { "type": "text", "id": "button_label", "label": "Button Label", "default": "Shop Now" },
    { "type": "url", "id": "button_link", "label": "Button Link", "default": "/collections/all" },
    { "type": "text", "id": "customer_text", "label": "Customer Count Text", "default": "Over 100,000+ Happy Customers" }
  ],
  "blocks": [
    {
      "type": "thumb_image",
      "name": "Thumbnail Image",
      "limit": 10,
      "settings": [
        { "type": "image_picker", "id": "thumb_img", "label": "Thumbnail Image" }
      ]
    },
    {
      "type": "review",
      "name": "Review Slide",
      "limit": 10,
      "settings": [
        { "type": "textarea", "id": "review_text", "label": "Review Text", "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor" },
        { "type": "text", "id": "review_author", "label": "Author", "default": "Lorem ipsum" },
        { "type": "text", "id": "review_date", "label": "Date", "default": "22/09/1996" },
        { "type": "range", "id": "review_stars", "label": "Star Rating", "min": 1, "max": 5, "step": 1, "default": 5 }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    { "name": "Custom Hero Section", "category": "Hero" }
  ]
}
{% endschema %}

<section class="custom-hero" {{ section.shopify_attributes }}>
  <div class="hero-container">
    <div class="hero-text">
      <h1>{{ section.settings.heading }}</h1>
      <p>{{ section.settings.subheading }}</p>
      {% assign shop_url = section.settings.button_link | default: '/collections/all' %}
      <a class="hero-button" href="{{ shop_url }}">{{ section.settings.button_label }}</a>
      <span class="customer-count">{{ section.settings.customer_text }}</span>
    </div>

    {% if section.settings.hero_image %}
    <div class="hero-image">
      <img src="{{ section.settings.hero_image | img_url: '720x' }}" alt="{{ section.settings.heading }}" />
    </div>
    {% endif %}
  </div>

  {% if section.blocks.size > 0 %}
  <div class="review-section">
    <div class="review-separator"></div>
    <div class="review-slider-wrapper">
      <div class="review-slider">
        {% if section.blocks.size > 1 %}
        <button class="nav-btn prev-btn" aria-label="Previous slide" style="display: none;">←</button>
        {% endif %}
        <div class="review-track">
          <div class="review-track-inner">
            {% for block in section.blocks %}
            <div class="review-slide" data-index="{{ forloop.index0 }}" data-type="{{ block.type }}" data-block-id="{{ block.id }}" {{ block.shopify_attributes }}>
              {% case block.type %}
                {% when 'review' %}
                  <div class="review-content-wrapper">
                    <p class="review-text">
                      {% if block.settings.review_text != blank %}
                        "{{ block.settings.review_text }}"
                      {% else %}
                        "Add your review text here"
                      {% endif %}
                    </p>
                    <div class="review-meta">
                      <span class="stars">{% for i in (1..block.settings.review_stars) %}★{% endfor %}</span>
                      {% if block.settings.review_author != blank %}
                        <span class="author">{{ block.settings.review_author }}</span>
                      {% else %}
                        <span class="author">Author Name</span>
                      {% endif %}
                      <span class="separator-dot">•</span>
                      {% if block.settings.review_date != blank %}
                        <span class="date">{{ block.settings.review_date }}</span>
                      {% else %}
                        <span class="date">Date</span>
                      {% endif %}
                    </div>
                  </div>
                {% when 'thumb_image' %}
                  <div class="thumb-slide-content">
                    {% if block.settings.thumb_img %}
                      <img src="{{ block.settings.thumb_img | img_url: '800x' }}" alt="{{ block.settings.thumb_img.alt | default: 'Thumbnail' }}" />
                    {% else %}
                      <div class="empty-slide">
                        <p>No image selected</p>
                      </div>
                    {% endif %}
                  </div>
              {% endcase %}
            </div>
            {% endfor %}
          </div>
        </div>
        {% if section.blocks.size > 1 %}
        <button class="nav-btn next-btn" aria-label="Next slide">→</button>
        {% endif %}
      </div>
      {% if section.blocks.size > 1 %}
      <div class="review-pagination">
        {% for block in section.blocks %}
        <span class="pagination-dot {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}"></span>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}
</section>

<style>
.custom-hero {
  padding: 60px 20px;
  background: linear-gradient(90deg, #ffffff, #f3eaff);
  max-width: 1200px;
  margin: 0 auto;
}

.hero-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 40px;
  margin-bottom: 60px;
}

.hero-text {
  flex: 1;
}

.hero-text h1 {
  font-size: 45px;
  font-weight: 700;
  margin: 0 0 20px 0;
  background: linear-gradient(135deg, #4a24ea, #3b82f6);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1.2;
  font-family: serif;
}

.hero-text p {
  font-size: 18px;
  color: #4a4a4a;
  margin: 0 0 30px 0;
  line-height: 1.6;
  font-family: serif;
}

.hero-button {
  display: inline-block;
  background: linear-gradient(135deg, #4a24ea, #3b82f6);
  color: #fff;
  padding: 12px 24px;
  margin: 20px 0;
  border-radius: 6px;
  text-decoration: none;
  font-weight: 500;
  transition: opacity 0.3s ease;
}

.hero-button:hover {
  opacity: 0.9;
}

.customer-count {
  display: block;
  margin-top: 15px;
  font-size: 16px;
  color: #4a4a4a;
  text-decoration: underline;
}

.hero-image {
  flex: 1;
  display: flex;
  justify-content: flex-end;
  height: 400px;
  min-height: 300px;
}

.hero-image img {
  width: 100%;
  max-width: 520px;
  height: 100%;
  max-height: 400px;
  border-radius: 0 50px 0 0;
  object-fit: cover;
}

.review-section {
  margin-top: 60px;
}

.review-separator {
  width: 100%;
  height: 1px;
  background: #e0e0e0;
  margin-bottom: 40px;
}

.review-slider-wrapper {
  position: relative;
}

.review-slider {
  display: flex;
  align-items: flex-start;
  gap: 30px;
  margin-bottom: 20px;
  justify-content: space-between;
}

.review-track {
  overflow: hidden;
  flex: 1;
  position: relative;
  min-width: 0;
}

.review-track-inner {
  display: flex;
  flex-direction: row;
  transition: transform 0.3s ease;
  will-change: transform;
  width: auto;
  min-width: 100%;
}

.review-slide {
  min-width: 0;
  width: 0;
  padding: 20px;
  text-align: center;
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  min-height: 200px;
}

.review-content-wrapper {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.thumb-slide-content {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.thumb-slide-content img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  object-fit: cover;
}

.thumb-slide-content .empty-slide {
  min-height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #9ca3af;
}

.review-text {
  font-size: 24px;
  color: #2a2a2a;
  margin: 0 0 20px 0;
  line-height: 1.5;
  font-weight: 400;
  max-width: 800px;
  word-wrap: break-word;
  overflow-wrap: break-word;
  width: 100%;
}

.review-meta {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  flex-wrap: wrap;
}

.stars {
  color: #000;
  font-size: 18px;
  letter-spacing: 3px;
  margin-right: 4px;
}

.author {
  color: #a78bfa;
  font-weight: 400;
  font-size: 16px;
}

.separator-dot {
  color: #a78bfa;
  font-size: 16px;
  margin: 0 4px;
}

.date {
  color: #9ca3af;
  font-size: 16px;
}

.nav-btn {
  background: transparent;
  border: 1px solid #9ca3af;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border-radius: 4px;
  font-size: 18px;
  color: #2a2a2a;
  transition: all 0.3s ease;
  flex-shrink: 0;
  padding: 0;
  margin-top:80px;
}

.nav-btn:hover {
  border-color: #2a2a2a;
  background: #f9fafb;
}

.review-pagination {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-top: 20px;
}

.pagination-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #d1d5db;
  cursor: pointer;
  transition: background 0.3s ease;
}

.pagination-dot.active {
  background: #000;
}

@media(max-width: 1024px) {
  .custom-hero {
    padding: 50px 20px;
  }
  
  .hero-container {
    gap: 35px;
  }
  
  .hero-text h1 {
    font-size: 40px;
  }
  
  .hero-image {
    height: auto;
  }
  
  .nav-btn {
    margin-top: 40px;
  }
}

@media(max-width: 768px) {
  .custom-hero {
    padding: 40px 15px;
  }
  
  .hero-container {
    flex-direction: column;
    text-align: center;
    gap: 30px;
    margin-bottom: 40px;
  }
  
  .hero-text {
    width: 100%;
  }
  
  .hero-text h1 {
    font-size: 32px;
    line-height: 1.3;
    margin-bottom: 15px;
  }
  
  .hero-text p {
    font-size: 16px;
    margin-bottom: 25px;
  }
  
  .hero-button {
    padding: 14px 28px;
    font-size: 16px;
    width: 100%;
    max-width: 280px;
    margin: 15px auto;
    display: block;
  }
  
  .customer-count {
    font-size: 14px;
    margin-top: 10px;
  }
  
  .hero-image {
    justify-content: center;
    height: auto;
    width: 100%;
    margin-top: 20px;
  }
  
  .hero-image img {
    width: 100%;
    max-width: 100%;
    border-radius: 20px;
    height: auto;
  }
  
  .review-section {
    margin-top: 40px;
  }
  
  .review-separator {
    margin-bottom: 30px;
  }
  
  .review-slider {
    gap: 15px;
    margin-bottom: 15px;
    align-items: center;
  }
  
  .review-track {
    min-width: 0;
  }
  
  .review-slide {
    padding: 15px 10px;
    min-height: 180px;
  }
  
  .review-text {
    font-size: 18px;
    line-height: 1.4;
    margin-bottom: 15px;
    padding: 0 10px;
  }
  
  .review-meta {
    flex-direction: column;
    gap: 6px;
    align-items: center;
  }
  
  .stars {
    font-size: 16px;
    letter-spacing: 2px;
    margin-right: 0;
    margin-bottom: 4px;
  }
  
  .author,
  .date {
    font-size: 14px;
  }
  
  .separator-dot {
    display: none;
  }
  
  .nav-btn {
    width: 36px;
    height: 36px;
    font-size: 16px;
    margin-top: 0;
    align-self: center;
  }
  
  .review-pagination {
    margin-top: 15px;
    gap: 6px;
  }
  
  .pagination-dot {
    width: 6px;
    height: 6px;
  }
  
  .thumb-slide-content img {
    border-radius: 12px;
  }
}

@media(max-width: 480px) {
  .custom-hero {
    padding: 30px 12px;
  }
  
  .hero-container {
    gap: 25px;
    margin-bottom: 30px;
  }
  
  .hero-text h1 {
    font-size: 28px;
    line-height: 1.2;
  }
  
  .hero-text p {
    font-size: 15px;
    margin-bottom: 20px;
  }
  
  .hero-button {
    padding: 12px 24px;
    font-size: 15px;
    max-width: 100%;
  }
  
  .review-section {
    margin-top: 30px;
  }
  
  .review-slider {
    gap: 10px;
  }
  
  .review-slide {
    padding: 12px 8px;
    min-height: 160px;
  }
  
  .review-text {
    font-size: 16px;
    padding: 0 5px;
  }
  
  .nav-btn {
    width: 32px;
    height: 32px;
    font-size: 14px;
  }
}
</style>

<script>
(function() {
  let sliderIndex = 0;
  let sliderTrack = null;
  let sliderSlides = null;
  let trackContainer = null;
  let nextBtn = null;
  let prevBtn = null;
  let dots = null;
  
  function getVisibleWidth() {
    if (trackContainer) {
      return trackContainer.offsetWidth || trackContainer.clientWidth || trackContainer.getBoundingClientRect().width;
    }
    return 0;
  }
  
  function setSlideWidths() {
    const visibleWidth = getVisibleWidth();
    
    if (visibleWidth > 0 && sliderSlides && sliderSlides.length > 0) {
      sliderSlides.forEach(slide => {
        slide.style.minWidth = visibleWidth + 'px';
        slide.style.width = visibleWidth + 'px';
        slide.style.maxWidth = visibleWidth + 'px';
        slide.style.flexShrink = '0';
        slide.style.display = 'flex';
      });
      
      if (sliderTrack) {
        sliderTrack.style.width = (visibleWidth * sliderSlides.length) + 'px';
      }
      
      updateSlider();
      return true;
    }
    return false;
  }
  
  function updateSlider() {
    if (!sliderTrack || !sliderSlides || sliderSlides.length === 0) return;
    
    const visibleWidth = sliderSlides[0]?.offsetWidth || getVisibleWidth();
    const translateX = -(sliderIndex * visibleWidth);
    
    sliderTrack.style.transform = `translateX(${translateX}px)`;
    sliderTrack.style.webkitTransform = `translateX(${translateX}px)`;
    
    if (dots) {
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === sliderIndex);
      });
    }
    
    if (prevBtn) {
      prevBtn.style.display = sliderIndex > 0 ? 'flex' : 'none';
    }
    
    if (nextBtn) {
      nextBtn.style.display = sliderIndex < sliderSlides.length - 1 ? 'flex' : 'none';
    }
  }
  
  function nextSlide(e) {
    if (e) {
      e.preventDefault();
      e.stopPropagation();
    }
    if (sliderSlides && sliderIndex < sliderSlides.length - 1) {
      sliderIndex++;
      updateSlider();
    }
  }
  
  function prevSlide(e) {
    if (e) {
      e.preventDefault();
      e.stopPropagation();
    }
    if (sliderSlides && sliderIndex > 0) {
      sliderIndex--;
      updateSlider();
    }
  }
  
  function goToSlide(index) {
    if (sliderSlides && index >= 0 && index < sliderSlides.length) {
      sliderIndex = index;
      updateSlider();
    }
  }
  
  function initSlider() {
    trackContainer = document.querySelector('.review-track');
    sliderTrack = document.querySelector('.review-track-inner');
    
    if (!sliderTrack || !trackContainer) {
      setTimeout(initSlider, 100);
      return;
    }
    
    nextBtn = document.querySelector('.next-btn');
    prevBtn = document.querySelector('.prev-btn');
    dots = document.querySelectorAll('.pagination-dot');
    sliderSlides = sliderTrack.querySelectorAll('.review-slide');
    
    if (!sliderSlides || sliderSlides.length === 0) return;
    
    if (sliderSlides.length === 1) {
      if (nextBtn) nextBtn.style.display = 'none';
      if (prevBtn) prevBtn.style.display = 'none';
      sliderTrack.style.transform = 'translateX(0)';
      return;
    }
    
    sliderIndex = 0;
    
    if (nextBtn) nextBtn.onclick = nextSlide;
    if (prevBtn) prevBtn.onclick = prevSlide;
    
    if (dots) {
      dots.forEach((dot, i) => {
        dot.onclick = (e) => {
          e?.preventDefault();
          e?.stopPropagation();
          goToSlide(i);
        };
      });
    }
    
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(setSlideWidths, 250);
    });
    
    if (!setSlideWidths()) {
      setTimeout(setSlideWidths, 150);
    }
  }
  
  function init() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => setTimeout(initSlider, 100));
    } else {
      setTimeout(initSlider, 100);
    }
    
    if (typeof window.Shopify !== 'undefined' && window.Shopify.designMode) {
      document.addEventListener('shopify:section:load', () => {
        sliderIndex = 0;
        sliderTrack = null;
        sliderSlides = null;
        trackContainer = null;
        nextBtn = null;
        prevBtn = null;
        dots = null;
        setTimeout(initSlider, 200);
      });
      
      document.addEventListener('shopify:block:select', (event) => {
        if (event.detail?.blockId && sliderTrack && sliderSlides) {
          const blockElement = document.querySelector(`[data-block-id="${event.detail.blockId}"]`);
          if (blockElement) {
            const blockIndex = parseInt(blockElement.getAttribute('data-index'), 10);
            if (!isNaN(blockIndex) && blockIndex < sliderSlides.length) {
              goToSlide(blockIndex);
            }
          }
        }
      });
    }
  }
  
  init();
})();
</script>
